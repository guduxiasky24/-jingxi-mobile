var userUploadFun = null;$(document).ready(function(){    var m = $skin;    var n = "";    var r = $("#pageForm");    var y = r.find("div.localBtn");    var p = r.find("div.upImgLoading");    var t, o;    var z = y.find("div.btn");    var u = $("#fuploadFile");    y.parent().mousemove(function(b) {        var a = $(window).width();        if (o != a) {            o = a;            t = y.offset();        }        $("#FileControl").css({            top: (b.pageY - t.top - 7) + "px",            left: (b.pageX - t.left - 190) + "px"        });        z.attr("class", "btnhov");    }).mouseout(function(a) {        z.attr("class", "btn");    });    u.mouseover(function() {        $(this).css("cursor", "pointer");    });    var s = function() {        this.ShowUploadPic = function(e) {            r.get(0).reset();            p.addClass("hidden");            y.removeClass("hidden");            var d = $("#ulPicBox");            var b = $("#hidPicAll");            var c = b.val();            if (c.indexOf(e) < 0) {                c += (c == "" ? "": ",") + e;                b.val(c);                var a = '<div id="img' + e.substr(0, 13) + '"><img src="' + $img + '/uploadImages/' + e + '" alt="" width="20%" height="50px"/><a href="javascript:;" onclick="javascript:delPostPic(\'' + e + '\');" title="删除此图片"></a></div>';                d.append(a).show();                $.PageDialog.ok('图片上传成功！');            } else {                return false;            }        };        this.ShowUploadErr = function(a) {            r.get(0).reset();            p.addClass("hidden");            y.removeClass("hidden");            $.PageDialog.fail(a);        };    };    userUploadFun = new s();    u.bind("change",    function() {        var b = $(this).val();        if (b != "") {            var a = (b.substr(b.length - 5)).substr((b.substr(b.length - 5)).indexOf(".") + 1).toLowerCase();            if (a != "png" && a != "jpg" && a != "jpeg" && a != "bmp") {                $(this).val("");                $.PageDialog.fail('只能上传PNG、JPG或BMP图片!');                return false;            } else {                y.addClass("hidden");                p.removeClass("hidden");                r.submit();            }        } else {        	$.PageDialog.fail('请先选择需要上传的文件!');            return false;        }    });    $("#upFrame").load(function() {        var a = $(window.frames.upFrame.document.body).text();        if (a != null) {            UploadFileScriptAPI("", a);        }    });    var v = function() {    	var b = ["标题不少于5个字", "恭喜您" + $shortName + "成功，在此输入您的" + $shortName + "感言吧，内容不少于100字，审核通过即可获得相应福分奖励哦！"];        var a = $("#codeID").val();        var c = function(e, d) {        	$.PageDialog.fail(d);            if (e != null) {                e.focus().val(e.val());            }        };            	$("#but_ok").click(function() {        	            if (!isLoaded) {                return false;            }            var d = $("#postTitle").val();            var f = $("#postTitle");            var g = $("#postContent").val();            var e = $("#postContent");            var h = $("#hidPicAll").val();            var i = $("#hidPicAll").val().split(",");            if (d == "" || d == b[0]) {                c(f, "请输入主题！");                return false;            }            if (d.length > 50) {                c(f, "主题不能超过50字！");                return false;            }            if (d.length < 5) {                c(f, "主题不能少于5个字！");                return false;            }            if (g == "" || g == b[1]) {                c(e, "请输入" + $shortName + "感言！");                return false;            }            if (g.length > 100) {                c(e, "" + $shortName + "感言不能超过100字！");                return false;            }            if (g.length < 15) {                c(e, "" + $shortName + "感言不能少于15个字！");                return false;            }            if (h.length < 53) {                c(null, "请上传3张以上原创图片！");                return false;            }            if (i.length > 10) {                c(null, "最多只能上传10张图片");                return false;            }          //  alert(a);            $.ajax({                url: "/user/PostSingleAddShare.action",                type: "post",                data: "id=" + a + "&postTitle=" + d + "&postContent=" + g + "&postAllPic=" + h,                success: function(j) {                	alert(j);                    if (j == "true") {                    	c(f, "晒单成功！");                        //OKDialog("\u63d0\u4ea4\u6210\u529f!", 160);                        location.replace("/user/PostSingleList.html");                    } else {                    	c(f, "晒单失败!");                    }                },                error: function() {                    c(null, "提交失败！");                }            });        });        $("#postTitle").focus(function() {           var d = $(this).val();           if (d == b[0]) {               $(this).val("").attr("class", "title_click");           }        }).blur(function() {           if ($(this).val() == "") {               $(this).val(b[0]).attr("class", "title");           }        });        $("#postContent").focus(function() {           var d = $(this).val();           if (d == b[1]) {               $(this).val("").attr("class", "textarea_click");           }        }).blur(function() {           if ($(this).val() == "") {               $(this).val(b[1]).attr("class", "textarea");           }        });        $("#addnewPostPic").click(function() {           var d = $("#hidPicAll").split(",");           if (d.length < 10) {               $.PageDialog('<iframe name="PostSingleFrame" id="PostSingleFrame"  scrolling="no" width="398" height="100" frameborder="0" src="about:blank"></iframe>', {                   W: 398,                   H: 150,                   title: "上传新晒单图片"               });               $("#PostSingleFrame").ready(function() {                  $("#PostSingleFrame").attr("src", "uploadPostImg.html");               });           } else {               alert("最多只能上传10张图片！");           }        });        isLoaded = true;    };    $.getScript(m + "/js/ajaxfun.js?date=20130123", v);});function UploadFileScriptAPI(c, d) {    if (c != "") {        userUploadFun.ShowUploadErr(c);    } else {        userUploadFun.ShowUploadPic(d);    }}function delPostPic(d) {    var c = function() {        var b = $("#hidPicAll");        var a = b.val();        if (a.indexOf(d) != -1) {            a = ("," + a + ",").replace("," + d + ",", ",");            b.val(a.substr(1, a.length - 2));        }        $("#img" + d.substr(0, 13)).remove();    };    $.PageDialog.confirm("您确定要删除该图片吗？", c);};